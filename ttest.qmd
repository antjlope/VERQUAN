---
title: "T-Test mit R"
author: "Annie Waldherr"
output: true
html_document: default
date: "2024-04-15"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Lernziele und Überblick

In diesem Tutorium lernen Sie, wie Sie Mittelwertunterschiede zwischen zwei unabhängigen Stichproben mit Hilfe eines t-Tests vergleichen können. Sie lernen, wie man:

-   die Daten für einen t-Test vorbereitet,
-   die Annahme der Varianzhomogenität mit dem Levene-Test prüft,
-   die Ergebnisse eines t-Tests berechnet, interpretiert und berichtet.

## Das Arbeitsverzeichnis

Wie immer prüfen wir zunächst mit "getwd()", unter welchem Pfad unser Arbeitsverzeichnis ist. Dies ist der Ordner, in den R alle in diesem Projekt erstellten Dokumente ablegt, und aus dem es auch Dokumente einliest. Alle Skripte und Datensätze, mit denen wir arbeiten wollen, sollten in diesem Ordner abgelegt sein. Wenn wir ein Projekt angelegt haben, wird dieses automatisch als Working Directory (Arbeitsverzeichnis) angelegt.

```{r Working Directory}
##Arbeitsverzeichnis checken
getwd()
```

Wollen wir einen anderen Ordner als Arbeitsverzeichnis festlegen, dann können wir das am besten händisch unter: Session -\> Set Working Directory -\> Choose Directory.

Oder wir verwenden die Funktion "setwd()" und geben in den Klammern den genauen Pfad zum gewünschten Ordner an.

## Pakete installieren und laden

Im Folgenden benötigen wir eine Reihe von R-Paketen, die nicht bereits in der Basisversion enthalten sind. Hierzu arbeiten wir dieses Mal mit dem Package "pacman". Das eignet sich gut, um gleich mehrere Pakete zu installieren und zu laden.

```{r Pakete installieren}
##Pakete installieren und laden
if (!require("pacman")) {install.packages("pacman"); library(pacman)}
p_load(mosaic, knitr, tidyverse, car)
library(dplyr)
```

## Daten einlesen

Der nächste Schritt ist wieder das Einlesen der Daten. Wir verwenden wie in der letzten Übung den Netflixdatensatz. Der Datensatz müsste noch in Ihrem Arbeitsverzeichnis liegen. Wenn nicht, dann kopieren Sie ihn nochmals dorthin.

```{r}
#Datensatz laden
netflix_films <- read.csv("data/NetflixOriginals.csv")

#Datensatz inspizieren

glimpse(netflix_films)
class(netflix_films)
head(netflix_films)
```

## Unabhängige und abhängige Variable definieren

Wir möchten prüfen, ob sich die Bewertung von Komödien oder Dramen signifikant unterscheidet. Hierzu wählen wir zunächst mit filter() die Fälle aus, in denen das Genre entweder "Comedy" oder "Drama" entspricht. Wir speichern diesen reduzierten Datensatz als neues Objekt der Klasse Dataframe mit Namen "df".

Dann definieren wir die Variable "Genre" als unabhängige Variable und die Variable "IMDB.Score" als abhängige Variable. Eine wichtige Voraussetzung für den t-Test ist, dass das Skalenniveua der UV nominal ist und nur zwei Ausprägungen hat (dichotom). Das Skalenniveu der AV muss metrisch sein. Wir prüfen mit glimpse(), ob dies der Fall ist.

```{r auf Variablen auswählen und definieren}
#Fälle auswählen und in neuem Dataframe speichern
df <- filter(netflix_films, Genre == "Comedy" | Genre == "Drama" )
glimpse(df)
head(df)
class(df)

#Unabhängige und abhängige Variable definieren
df$uv <- as.factor(df$Genre) #die UV wandeln wir in einen Faktor um
df$av <- df$IMDB.Score
```

## Deskriptive Statistiken der AV

Nun lassen wir uns zunächst mit der Funktion "favstats" die wichtigsten deskriptiven Statistiken ausgeben.

```{r Mittelwert und Standardabweichung}
#Label UV vergeben
label_uv <- "Genre"

#Deskriptive Statistiken berechnen
des_stat <- favstats(df$av ~ df$uv)

# Tabelle erstellen
kable (des_stat,
       col.names = c(label_uv,"Minimum", "1.Quartil", 
                     "Median", "3.Quartil", "Maximum", 
                     "M", "SD", "N", "Fehlend" ),
       digits = 2)
```

Wir sehen, dass Dramen durchschnittlich höher bewertet werden als Komödien. Das bedeutet aber noch nicht, dass dieser Unterschied auch statistisch signifikant ist. Es könnte ja sein, dass wir diesen Unterschied nur zufällig in unserer Stichprobe messen, in Wahrheit aber gar kein Unterschied besteht. Um dies zu prüfen, führen wir im folgenden einen t-Test für unabhängige Stichproben durch.

## Levene-Test zur Voraussetzungsprüfung

Zunächst müssen wir aber eine wichtige Voraussetzung prüfen: Varianzhomogenität. Wir wollen wissen, ob sich die Varianzen in den beiden Gruppen (Dramen vs. Komödien) signifikant unterscheiden. Hierzu führen wir den Levene-Test durch. Abhängig von diesem Ergebnis wählen wir das weitere Testverfahren.

Zunächst rufen wir den Datensatz "df" auf. Da wir im Folgenden gleich mehrere Verarbeitungsschritte aneinander hängen werden, arbeiten wir mit dem %\>%-Operator, der Pfeife, gelesen als "und dann". Wir nehmen also unseren Datensatz "df", und dann entfernen wir alle fehlenden Werte (Fälle, in denen unserer UV oder AV fehlen) mit der Funktion drop_na() aus dem tidyverse-Paket entfernt; und dann führen wir den Levene-Test durch.

Mit dem Argument av \~ uv definieren wir die Variablen, für die die Varianzhomogenität geprüft werden.

Da wir zuvor bereits unseren Datensatz festgelegt haben, können wir mit dem Argument "data = ." auf diesen verweisen.

```{r Levene Test}
df %>%
  drop_na(uv, av) %>%
  leveneTest(av~uv, data = .)
```

Der Levene-Test ist nicht signifikant (F(1,124) = 0,08, p = 0,78), denn p ist größer als 0,05. Somit wird die Nullhypothese beibehalten und wir können von Varianzhomogenität ausgehen und mit dem t-Test fortfahren.

**Wichtig!** Wäre der Levene-Test signifikant, d.h. die Varianzen der Werte in den beiden Gruppen sind ungleich, müssten wir statt dem t-test für unabhängige Stichproben den Welch-Test durchführen, der keine Varianzhomogenität voraussetzt (siehe unten).

## t-Test

Wir führen nun den t-Test durch. Die Logik des unten stehenden Codes folgt dem des Levene-Tests oben, nur dass wir nun den "t.test" durchführen, mit der gleichen av und uv wie zuvor. Wir testen "two.sided", d.h. zweiseitig, auf Signifikanz der Mittelwertunterschiede in beide Richtungen (Drama \> Comedy und Drama \< Comedy). Die Hypothese, die wir testen, ist also ungerichtet:

H1: Filme vom Genre Drama werden signifikant unterschiedlich bewertet als Filme vom Genre Comedy. H0: Die Bewertungen der beiden Genres unterscheiden sich nicht.

*Frage*: Können Sie auch eine gerichtete Hypothese formulieren? Wie würden Sie diese begründen?

Das Argument "var.equal = T" wird genutzt, wenn der Levene-Test nicht signifikant ist und somit Varianzhomogenität vorliegt. Ist dies nicht der Fall, müssen wir "var.equal = F" setzen. Dann wird der Welch-Test berechnet.

```{r t-Test}
df %>%
  drop_na(uv, av) %>%
  t.test(av~uv, 
         alternative = "two.sided",
         var.equal = T,
         data = .)
```

Im Output wird uns in der ersten Zeile ausgegeben, für welche AV und UV der t-Test berechnet wurde. Es folgen die Angaben zur Teststatistik (t = -5,9272, df=124, p-value=2.846e-08). Der T-Wert beträgt -5,9272 bei 124 Freiheitsgraden. Das negative Vorzeichen weist daraufhin, dass der Mittelwert der Gruppe Comedy kleiner ist als der Mittelwert der Gruppe Drama. Der p-Wert (p-value) beträgt p=2.846e-08 oder umgerechnet p=0,00000002846. Das ist deutlich kleiner als 0,05 und sogar deutlich kleiner als 0,001, d.h. p \< 0,001 und damit höchst signifikant.

Wir berichten das Ergebnis wie folgt: Filme vom Genre Comedy (M = 5,51, SD = 0,79) werden signifikant schlechter bewertet als Filme vom Genre Drama (M = 6,34, SD = 0,76, t = -5,9272, df=124, p \< 0,001).

## Zum Nachlesen

Dieses Skript folgt in weiten Teilen Kapitel 12.3 in: Gehrau, V., Maubach, K., Fujarski, S. (2022). Einfache Datenauswertung mit R.

## Hausübung 2

Jetzt sind Sie dran! Prüfen Sie, ob sich Dokumentarfilme und Dramen signifikant in ihrer Länge unterscheiden.

1.  Wählen Sie die Fälle nach den nun gewünschten Genres aus und speichern Sie sie in einem neuen Dataframe.

```{r Fälle auswählen}
#wählen Sie die Fälle nach den gewünschten Genres aus und speichern Sie sie in einem neuem Dataframe.


```

2.  Identifizieren Sie unabhängige und abhängige Variable und legen Sie diese fest. Vergessen Sie nicht, die UV in einen Faktor umzuwandeln.

```{r Unabhängige und abhängige Variable definieren}

#UV und AV definieren; UV dabei in Faktor umwandeln
#Unabhängige und abhängige Variable definieren
#die UV wandeln wir in einen Faktor um

```

3.  Welches Skalenniveau haben die beiden Variablen?

Antwort: Ordinal (Score) und Nominal (Genre)

4.  Führen Sie nun den Levene-Test durch. Was ergibt er?

Antwort: Das Ergebnis ist nicht signifikant ((F=1,234, p=0,74%), denn p ist größer als 0,05. Die Nullhypothese wird somit beibehalten, Varianz ist homogen und der T-Test kann berechnet werden.

```{r Levene-Test}
#Levene-Test durchführen

```

5.  Was für ein statistischer Test muss nun für den Mittelwertvergleich gerechnet werden? Begründen Sie Ihre Wahl kurz.

<!-- -->

6.  Formulieren Sie Nullhypothese und Alternativhypothese für den Mittelwertvergleich:

7.  Berechnen und interpretieren Sie nun den Test. Was ergibt der Test?

**Tipp!** Sie müssen den Code nicht komplett selbst eintippen. Suchen Sie die entsprechenden Code-Chunks oben und übertragen Sie sie per Copy-Paste in die Platzhalter hier unten. In der Regel müssen Sie nur die Variablennamen und ggf. weitere Parameter anpassen. Bitte fügen Sie auch nur die Befehle und Berechnungen an, die jeweils in der Aufgabenstellung gefragt sind, d.h. löschen Sie Befehle, die nicht zur Aufgabenstellung gehören.

**Wichtig!** Speichern Sie das angepasste Markdown mit einem Dateinamen nach dem folgenden Muster: Nachname_Übung2.Rmd Laden Sie diese Datei in den dafür vorgesehenen Ordner in Moodle.
